<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>&lrm;</title>
<style>
    * {
        background-color: #404040;
        color: white; /* White */
        font-family: "Roboto Condensed", Arial, sans-serif;
    }
    #card {
        max-width: 400pt;
        margin: 0 auto;
        padding: 6pt;
    }
    #textContainer {
        display: flex;
        flex-direction: column;
        justify-content: center;
        padding-bottom: 6pt;
    }
    .textField {
        width: 100%;
        background-color: transparent; /* Dark Grey */
        border: 0;
        padding: 6pt;
        text-align: center;
        font-size: 31pt; /* Default font size */
        outline: none;
    }
    #pageTitle {
        min-height: 24pt;
    }
    #pageColor, #faviconBtn {
        min-height: 24pt;
        font-size: 16pt;
    }
    #faviconBtn {
        width: 50%;
        border: 0;
        text-align: right;
        margin: 0 auto;
        cursor: pointer;
        line-height: 60%;
    }
    #clearFavicon {
        font-size: 7pt;
    }
    #pageColor {
        text-align: left;
        width: fit-content;
    }
    #textContainer > div {
        display: flex;
        width: 100%;
    }
    #textContainer > div > input {
        flex: 1;
    }
    #textContainer > div > button {
        width: 50%;
        margin-left: 6pt;
    }
    #colors {
        display: grid;
        grid-template-columns: repeat(8, 1fr); /* Equal width columns */
        grid-template-rows: repeat(8, 1fr); /* Equal height rows */
        gap: 0;
        aspect-ratio: 1 / 1;
        height: 100%;
    }
    .colorButton {
        width: 100%; /* Button width fills parent */
        height: 100%; /* Button height fills parent */
        border: none;
        cursor: pointer;
    }

    /* Media query for viewport width */
    @media (max-width: 400pt) {
        #pageTitle, #pageColor, #faviconBtn {
            font-size: calc(10pt + 6 * (100vw - 200pt) / 200); /* Linear scaling of font size */
        }
    }
</style>
</head>
<body>

<div id="card">
    <div id="textContainer">
        <div>
            <input type="text" id="pageTitle" class="textField" placeholder="Page title">
        </div>
        <div>
            <button id="faviconBtn" >Favicon color<br/><span id="clearFavicon">CLICK HERE TO CLEAR</span></button>
            <input type="text" id="pageColor" class="textField" placeholder="Transparent">
        </div>
    </div>
    <div id="colors"></div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var pageTitle = document.getElementById('pageTitle');
        var pageColor = document.getElementById('pageColor');
        var colorsDiv = document.getElementById('colors');
        var faviconBtn = document.getElementById('faviconBtn');
        var clearFavicon = document.getElementById('clearFavicon'); // Add this line
    
        var originalTitle = document.title; // Store the original title of the page
        var originalQuery = window.location.search; // Store the original query string
    
        // Set the title to the query string when the page is loaded
        if (originalQuery !== '') {
            document.title = decodeURIComponent(originalQuery.substring(1)); // Decode the query string
        }
    
        function updateFavicon(color) {
            var faviconCanvas = document.createElement('canvas');
            var context = faviconCanvas.getContext('2d');
            var head = document.head || document.getElementsByTagName('head')[0];
            
            faviconCanvas.width = 32;
            faviconCanvas.height = 32;
            context.clearRect(0, 0, 32, 32);
            
            if (color) {
                context.beginPath();
                context.arc(16, 16, 12, 0, Math.PI * 2);
                context.fillStyle = color;
                context.fill();
            }
    
            var newFavicon = faviconCanvas.toDataURL();
            var favicon = document.querySelector('link[rel="icon"]') || document.createElement('link');
            favicon.type = 'image/x-icon';
            favicon.rel = 'icon';
            favicon.href = newFavicon;
            head.appendChild(favicon);
        }
    
        function changeTitle(newTitle) {
            document.title = newTitle || originalTitle; // Set the title to the original title if newTitle is empty
        }
    
        function createColorButton(color) {
            var button = document.createElement('button');
            button.className = 'colorButton';
            button.style.backgroundColor = '#' + color;
            button.onclick = function() {
                pageColor.value = '#' + color; // Set pageColor value to the selected color
                updateFavicon('#' + color);
            };
            return button;
        }
    
        var colors = [ // maybe order from darker to lighter?
            '000000', '550000', 'AA0000', 'FF0000',
            '000055', '550055', 'AA0055', 'FF0055',
            '005500', '555500', 'AA5500', 'FF5500',
            '005555', '555555', 'AA5555', 'FF5555',
            '00AA00', '55AA00', 'AAAA00', 'FFAA00',
            '00AA55', '55AA55', 'AAAA55', 'FFAA55',
            '00FF00', '55FF00', 'AAFF00', 'FFFF00',
            '00FF55', '55FF55', 'AAFF55', 'FFFF55',
            '0000AA', '5500AA', 'AA00AA', 'FF00AA',
            '0000FF', '5500FF', 'AA00FF', 'FF00FF',
            '0055AA', '5555AA', 'AA55AA', 'FF55AA',
            '0055FF', '5555FF', 'AA55FF', 'FF55FF',
            '00AAAA', '55AAAA', 'AAAAAA', 'FFAAAA',
            '00AAFF', '55AAFF', 'AAAFFF', 'FFAAFF',
            '00FFAA', '55FFAA', 'AAFFAA', 'FFFFAA',
            '00FFFF', '55FFFF', 'AAFFFF', 'FFFFFF'
        ];
    
        for (var i = 0; i < colors.length; i++) {
            var button = createColorButton(colors[i]);
            colorsDiv.appendChild(button);
        }
    
        faviconBtn.addEventListener('click', function() {
            updateFavicon('');
            pageColor.value = ''; // Clear the pageColor value
        });
    
        pageColor.addEventListener('input', function() {
            var colorValue = pageColor.value.trim().toLowerCase();
            if (colorValue === 'transparent') {
                updateFavicon('');
            } else if (colorValue.match(/^#(?:[0-9a-f]{3}){1,2}$/)) {
                updateFavicon(colorValue);
            }
            clearFavicon.style.visibility = colorValue ? 'visible' : 'hidden'; // Show clearFavicon if pageColor is not blank
        });
    
        pageTitle.addEventListener('input', function() {
            var newTitle = pageTitle.value.trim();
            if (newTitle === '') {
                changeTitle(originalQuery !== '' ? decodeURIComponent(originalQuery.substring(1)) : originalTitle);
            } else {
                changeTitle(newTitle);
            }
        });
    
        pageTitle.focus();
    });
</script>
    
</body>
</html>
